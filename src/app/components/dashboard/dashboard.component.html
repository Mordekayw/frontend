<app-navbar></app-navbar>

<div class="container mt-4">
  <!-- ------------------------ DASHBOARD ADMINISTRADOR / RECEPCIONISTA ------------------------ -->
  <div *ngIf="isAdmin || isRecepcionista" role="region" aria-label="Resumen Operacional del Hotel">
    <header>
      <h2 class="mb-4">Dashboard Personal</h2>
      <p class="lead">Bienvenido al sistema de gestión hotelera, **{{ user?.sub || 'Usuario' }}**.</p>
    </header>

    <h3 class="mt-5 mb-4">Resumen Operacional</h3>

    <!-- Fila 1: Métricas Globales (Admin) -->
    <div *ngIf="isAdmin" class="row">
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Total de Habitaciones">
          <i class="fas fa-bed fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Total de Habitaciones</h5>
          <p class="metric-value">{{ totalHabitaciones }}</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Total de Clientes">
          <i class="fas fa-users fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Total Clientes</h5>
          <p class="metric-value">{{ totalClientes }}</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Total de Reservas">
          <i class="fas fa-calendar-check fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Total Reservas</h5>
          <p class="metric-value">{{ totalReservas }}</p>
        </div>
      </div>
    </div>

    <!-- Fila 2: Estado de Habitaciones (Admin / Recepcionista) -->
    <div class="row mt-4">
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Habitaciones Disponibles">
          <i class="fas fa-check-circle fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Habitaciones Disponibles</h5>
          <p class="metric-value">{{ habitacionesDisponibles }}</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Habitaciones Ocupadas">
          <i class="fas fa-door-closed fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Habitaciones Ocupadas</h5>
          <p class="metric-value">{{ habitacionesOcupadas }}</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Habitaciones en Mantenimiento">
          <i class="fas fa-tools fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">En Mantenimiento</h5>
          <p class="metric-value">{{ habitacionesMantenimiento }}</p>
        </div>
      </div>
    </div>

    <!-- Fila 3: Ingresos (Solo Admin) -->
    <div *ngIf="isAdmin" class="row mt-4">
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Ingresos Totales">
          <i class="fas fa-dollar-sign fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Ingresos Totales</h5>
          <p class="metric-value">S/. {{ ingresosTotales | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ------------------------ DASHBOARD CLIENTE ------------------------ -->
  <div *ngIf="isCliente" role="region" aria-label="Mi Cuenta y Reservas de Cliente">
    <header>
      <h2 class="mb-4">Mi Cuenta - Cliente</h2>
    </header>

    <h3 class="mb-4">Resumen de Reservas</h3>
    <div class="row">
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Reservas Activas">
          <i class="fas fa-calendar-alt fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Reservas Activas</h5>
          <p class="metric-value">{{ reservasActivasCliente }}</p>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="metric-card" role="status" aria-label="Reservas Finalizadas">
          <i class="fas fa-history fa-3x" aria-hidden="true"></i>
          <h5 class="metric-label">Reservas Finalizadas</h5>
          <p class="metric-value">{{ reservasFinalizadasCliente }}</p>
        </div>
      </div>
    </div>

    <div class="mt-5">
      <h3>Historial de Reservas</h3>
      <div *ngIf="reservasCliente.length === 0" class="alert alert-info" role="alert">
        No tienes reservas registradas.
      </div>

      <!-- Tabla de Historial -->
      <div *ngIf="reservasCliente.length > 0" class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Habitación</th>
              <th>Entrada</th>
              <th>Salida</th>
              <th>Total</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reserva of reservasCliente">
              <td>{{ reserva.habitacion?.numero }} ({{ reserva.habitacion?.tipo }})</td>
              <td>{{ reserva.fechaInicio | date:'dd-MM-yyyy' }}</td>
              <td>{{ reserva.fechaFin | date:'dd-MM-yyyy' }}</td>
              <td>S/. {{ reserva.totalPagar | number:'1.2-2' }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-primary': reserva.estadoReserva === 'ACTIVA',
                  'bg-info': reserva.estadoReserva === 'PENDIENTE',
                  'bg-success': reserva.estadoReserva === 'FINALIZADA',
                  'bg-danger': reserva.estadoReserva === 'CANCELADA'
                }" aria-label="Estado de la reserva: {{ reserva.estadoReserva }}">
                  {{ reserva.estadoReserva }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
